#!/usr/bin/env bash
set -e

echo "ðŸ¤– Setting up OpenAI Codex CLI..."

# Check if codex is installed
if ! command -v codex &>/dev/null; then
  echo "âŒ Codex CLI not found. Please install it first with 'brew install codex'"
  exit 1
fi

echo "âœ… Codex CLI found: $(codex --version)"

# Check if already authenticated
if codex login --check &>/dev/null; then
  echo "âœ… Codex is already authenticated"
else
  echo "ðŸ” Setting up Codex authentication..."
  echo "Please follow the authentication process:"
  codex login || true
fi

# Create basic config directory if it doesn't exist
mkdir -p ~/.codex

echo "ðŸ“ Creating basic Codex configuration..."
cat > ~/.codex/config.toml << 'EOF'
# OpenAI Codex CLI Configuration
# Generated by dotfiles setup

[general]
# Default model to use
model = "o1-mini"

[sandbox]
# Sandbox permissions for safety
default_policy = "workspace-write"

[approval]
# When to ask for approval
policy = "untrusted"
EOF

echo "âœ… Codex setup complete!"
echo "ðŸ’¡ You can now use 'codex' to start an AI coding session"
echo "ðŸ’¡ Run 'codex --help' for more options"